# kubeadm data

The resource provides the global configuration for the cluster.

## Example Usage

```hcl
data "kubeadm" "main" {
  api {
    external = "loadbalancer.external.com"
  }
  
  network {
    dns_domain = "my_cluster.local"  
    services = "10.25.0.0/16"
  }
}
```

## Argument Reference

The following arguments are supported:

* `api` - (Optional) API server configuration.
* `cni` - (Optional) CNI configuration.
* `token` - (Optional) force a particular cluster formation
token (autogenerated when empty).
* `network` - (Optional) network configuration.
* `images`  - (Optional) images used for running the different services.
* `etcd`  - (Optional) `etcd` configuration.
* `version`  - (Optional) kubernetes version.

## Nested Blocks

### `api`

#### Arguments

* `external` - (Optional) stable IP/DNS (and port) for the control plane (for example, the load balancer).
* `internal` - (Optional) IP/DNS and port the local API server advertises it's accessible.
* `alt_names` - (Optional) list of SANs to use in api-server certificate. Example: `IP=127.0.0.1,IP=127.0.0.2,DNS=localhost`, If empty, SANs will be obtained from the _external_ and _internal_ names/IPs.

### `cni`

#### Arguments

* `plugin` - (Optional) when not empty, name of the CNI plugin to load in the
cluster after the initial bootstrap. There is a list of pre-defined manifests
to load for some well-known plugins, being the list of recognized names:
  * `flannel`
* `plugin_manifest`  - (Optional) when not empty, load the CNI driver by using
the provided manifest. When both `plugin` and `plugin_manifest` are provided,
the former one is ignored.
* `bin_dir` - (Optional) binaries directory for CNI.
* `conf_dir` - (Optional) configuration directory for CNI.

### `network`

#### Arguments

* `services` - (Optional) subnet used by k8s services. Defaults to `10.96.0.0/12`.
* `pods` - (Optional) subnet used by pods.
* `dns_domain` - (Optional) DNS domain used by k8s services. Defaults to `cluster.local`.

Example:
```hcl
data "kubeadm" "main" {
  network {
    dns_domain = "mycluster.com"
    services   = "10.25.0.0/16"
  }
}
```

### `images`

#### Arguments

* `kube_repo` - (Optional) the kubernetes images repository.
* `etcd_repo` - (Optional) the etcd image repository.
* `etcd_version` - (Optional) the etcd version.

### `etcd`

#### Arguments

* `endpoints` - (Optional) list of etcd servers URLs including `host:port`.

Example:
```hcl
data "kubeadm" "main" {
  etcd {
    endpoints = ["server1.com:2379", "server2.com:2379"]
  }
}
```

### `runtime`

#### Arguments

* `engine` - (Optional) containers runtime to use: `docker`/`crio`.
* `extra_args` - (Optional) extra arguments for the components:
  * `api_server` - (Optional) extra arguments for the API server.
  * `controller_manager` - (Optional) extra arguments for the controller manager.
  * `scheduler` - (Optional) extra arguments for the scheduler.
  * `kubelet` - (Optional) extra arguments for the kubelet.

Example:
```hcl
data "kubeadm" "main" {
  runtime {
    engine = "crio"
    extra_args {
      api_server = {
        "feature-gates" = "DynamicKubeletConfig=true"
      }
    }
  }
```

